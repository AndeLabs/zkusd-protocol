# zkUSD Price Oracle Deployment Spell (FIXED VERSION)
# CRITICAL: ins UTXO must be DIFFERENT from --funding-utxo
# ins: contains the UTXO that will "receive" the charm
# --funding-utxo: separate UTXO that pays for commit/reveal fees

version: 8

apps:
  # Oracle as NFT: n/{app_id}/{vk}
  $00: n/b44db07ac1697704ea7170f4e857c50c4545f0de00dfcc11835dc6efb0c27c32/b44db07ac1697704ea7170f4e857c50c4545f0de00dfcc11835dc6efb0c27c32

# Witness data - Initialize operation
private_inputs:
  $00:
    # op code 0x00 = Initialize
    op: 0
    # Admin address (padded 20-byte pubkey hash to 32 bytes)
    admin: [213, 79, 168, 49, 172, 25, 87, 76, 85, 3, 241, 203, 213, 5, 147, 74, 11, 171, 60, 238, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    # Operator address (same as admin for initial deployment)
    operator: [213, 79, 168, 49, 172, 25, 87, 76, 85, 3, 241, 203, 213, 5, 147, 74, 11, 171, 60, 238, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    # Initial price: $100,000 (8 decimals)
    price: 10000000000000

ins:
  # INPUT UTXO - This is the UTXO that will be "enchanted" with the charm
  # NOTE: This MUST be different from --funding-utxo!
  - utxo_id: d879b31e32d91fee25c699fbb16c3b45beaed80f7fadb37c1a7e441e4c925014:0
    charms: {}

outs:
  # Output with oracle charm containing initial OracleState
  # Using our wallet address to receive the charm
  - address: tb1qr25l2p34sv4wnz4q0cuh4g9jd9qh2eua6y5awq
    charms:
      $00:
        # PriceData struct
        price:
          price: 10000000000000
          timestamp_block: 0
          source: Mock
          confidence: 100
        # Operator address (32 bytes)
        operator: [213, 79, 168, 49, 172, 25, 87, 76, 85, 3, 241, 203, 213, 5, 147, 74, 11, 171, 60, 238, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
        # Admin address (32 bytes)
        admin: [213, 79, 168, 49, 172, 25, 87, 76, 85, 3, 241, 203, 213, 5, 147, 74, 11, 171, 60, 238, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
        # Oracle is active
        is_active: true
        # Last valid price
        last_valid_price: 10000000000000
