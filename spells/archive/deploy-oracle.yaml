# zkUSD Price Oracle Deployment Spell
# Creates an NFT charm with the initial oracle state
#
# ⚠️  CRITICAL: UTXO SEPARATION RULE ⚠️
# The UTXO in 'ins:' MUST be DIFFERENT from '--funding-utxo'!
# See: docs/CHARMS_DEPLOYMENT_FIX.md
#
# ❌ WRONG: ins: abc:0  AND  --funding-utxo "abc:0"
# ✅ CORRECT: ins: abc:0  AND  --funding-utxo "xyz:1"

version: 8

apps:
  # Oracle as NFT: n/{app_id}/{vk}
  $00: n/606fb4c5450d5eac07b316664d288891c82813a7e504f5a4a869052988f504a9/b44db07ac1697704ea7170f4e857c50c4545f0de00dfcc11835dc6efb0c27c32

# Witness data - Initialize operation
private_inputs:
  $00:
    # op code 0x00 = Initialize
    op: 0
    # Admin address (padded 20-byte pubkey hash to 32 bytes)
    admin: [213, 79, 168, 49, 172, 25, 87, 76, 85, 3, 241, 203, 213, 5, 147, 74, 11, 171, 60, 238, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    # Operator address (same as admin for initial deployment)
    operator: [213, 79, 168, 49, 172, 25, 87, 76, 85, 3, 241, 203, 213, 5, 147, 74, 11, 171, 60, 238, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    # Initial price: $100,000 (8 decimals)
    price: 10000000000000

ins:
  # Funding UTXO (no charms attached)
  - utxo_id: d629a85353048e869baf09f80b21ae1a668f1a333eddd46fc22c17aa811aac6a:0
    charms: {}

outs:
  # Output with oracle charm containing initial OracleState
  - address: tb1qr25l2p34sv4wnz4q0cuh4g9jd9qh2eua6y5awq
    charms:
      $00:
        # PriceData struct
        price:
          price: 10000000000000
          timestamp_block: 0
          source: Mock
          confidence: 100
        # Operator address (32 bytes)
        operator: [213, 79, 168, 49, 172, 25, 87, 76, 85, 3, 241, 203, 213, 5, 147, 74, 11, 171, 60, 238, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
        # Admin address (32 bytes)
        admin: [213, 79, 168, 49, 172, 25, 87, 76, 85, 3, 241, 203, 213, 5, 147, 74, 11, 171, 60, 238, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
        # Oracle is active
        is_active: true
        # Last valid price
        last_valid_price: 10000000000000
