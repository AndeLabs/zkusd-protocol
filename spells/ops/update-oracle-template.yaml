# =============================================================================
# zkUSD Update Oracle Spell (Operational Template)
# =============================================================================
# Update the BTC/USD price in the Price Oracle
#
# DEPLOYMENT VALUES:
#   Price Oracle VK:    b44db07ac1697704ea7170f4e857c50c4545f0de00dfcc11835dc6efb0c27c32
#   Price Oracle ID:    (generated from deployment UTXO)
#
# PERMISSION: Admin only (requires oracle operator signature)
#
# PRICE FORMAT: USD with 8 decimals
#   $100,000.00 = 10000000000000 (100000 * 10^8)
#   $50,000.00  = 5000000000000
#   $104,235.50 = 10423550000000
# =============================================================================

version: 8

apps:
  # Price Oracle NFT: n/{app_id}/{vk}
  $ORACLE: n/${ORACLE_APP_ID}/b44db07ac1697704ea7170f4e857c50c4545f0de00dfcc11835dc6efb0c27c32

# Witness data for Update operation
private_inputs:
  $ORACLE:
    op: 1                                     # UPDATE_PRICE
    new_price: ${NEW_PRICE}                   # USD with 8 decimals
    timestamp: ${TIMESTAMP}                   # Unix timestamp

ins:
  # Input 1: Current Oracle state UTXO
  - utxo_id: ${ORACLE_UTXO}
    charms:
      $ORACLE:
        price: ${CURRENT_PRICE}
        last_update: ${LAST_UPDATE}
        source: ${SOURCE}                     # e.g., "manual" or "chainlink"
        admin: ${ADMIN_PUBKEY}

outs:
  # Output 1: Updated Oracle state
  - address: ${ORACLE_ADDRESS}
    charms:
      $ORACLE:
        price: ${NEW_PRICE}
        last_update: ${TIMESTAMP}
        source: ${SOURCE}
        admin: ${ADMIN_PUBKEY}

# =============================================================================
# EXAMPLE: Update price to $104,500
# =============================================================================
# NEW_PRICE: 10450000000000 (104,500.00000000 USD)
# TIMESTAMP: 1734278400 (Unix timestamp)
#
# Price validation:
#   - Must be > 0
#   - Reasonable range: $10,000 - $1,000,000 per BTC
#   - Max change per update: typically 20% from current (circuit breaker)
# =============================================================================
