# ============================================================================
# OpenVault V9 - End-to-End Mint Test
# ============================================================================
# Opens a new vault with BTC collateral and mints zkUSD tokens.
#
# Multi-app spell involving:
#   $00: VaultManager V6 (NFT) - manages vault state
#   $01: zkUSD Token V8 (fungible) - minted zkUSD tokens
#   $02: zkUSD Token V8 (NFT state) - token state with total_supply
#
# Parameters:
#   Collateral:    500,000 sats (0.005 BTC)
#   User debt:     10 zkUSD (1,000,000,000 base units)
#   Vault debt:    12 zkUSD (1,200,000,000 = debt + 2 zkUSD liquidation reserve)
#   BTC Price:     $100,000 (10,000,000,000,000 with 8 decimals)
#   ICR:           ~4166% (well above 110% MCR)
#
# VaultManager V6 app_id: e6564c00d5ea8cb8226c7c334ab7089c806149debe1382c75c1909f447290b3c
# Token V8 app_id:        a2a55bf3131001674e2dfc952944d870aab7b5eddf929c1bde1f1e739c230770
# ============================================================================

version: 9

apps:
  # VaultManager V6 NFT (manages protocol + vault state)
  $00: n/e6564c00d5ea8cb8226c7c334ab7089c806149debe1382c75c1909f447290b3c/5d4f82322c90250b7db0402449708c6871627c38139f17df3806d0926de9367b
  # zkUSD Token V8 fungible (minted zkUSD balance)
  $01: t/a2a55bf3131001674e2dfc952944d870aab7b5eddf929c1bde1f1e739c230770/395ceff8ff029ff4399fb158859cf7e59a6b1b7383306d2229bcf20e014201c4
  # zkUSD Token V8 NFT state (token admin/minter/supply tracking)
  $02: n/a2a55bf3131001674e2dfc952944d870aab7b5eddf929c1bde1f1e739c230770/395ceff8ff029ff4399fb158859cf7e59a6b1b7383306d2229bcf20e014201c4

private_inputs:
  # VaultManager witness - OpenVault operation
  $00:
    op: 16
    vault_id: [87, 46, 248, 147, 118, 173, 125, 47, 94, 0, 109, 225, 244, 162, 51, 17, 74, 101, 132, 139, 174, 166, 33, 106, 105, 156, 221, 199, 73, 35, 184, 45]
    collateral: 500000
    debt: 1000000000
    flash_purpose: null
    rescuer_discount: null
    coverage: null
    premium: null
    trigger_icr: null
    insurance_id: null
    new_owner: null
  # Token NFT witness - Mint operation
  $02:
    op: 2
    from: null
    to: [15, 239, 114, 232, 40, 108, 13, 216, 213, 221, 86, 158, 147, 4, 51, 195, 34, 51, 13, 51, 134, 80, 173, 193, 170, 10, 69, 2, 211, 90, 23, 72]
    amount: 1000000000

public_inputs:
  # BTC price data for VaultManager validation
  $00:
    price: 10000000000000
    timestamp_block: 120228
    source: Mock
    confidence: 100

ins:
  # Input 0: VaultManager V6 state UTXO (consumed - state updates)
  - utxo_id: "eb13f9b9d0ed1eb8160b7e0732ad03ca0473cb3e3ed5e3b7936630e7a4c4d261:0"
    charms:
      $00:
        protocol:
          total_collateral: 0
          total_debt: 0
          active_vault_count: 0
          base_rate: 50
          last_fee_update_block: 0
          admin: [15, 239, 114, 232, 40, 108, 13, 216, 213, 221, 86, 158, 147, 4, 51, 195, 34, 51, 13, 51, 134, 80, 173, 193, 170, 10, 69, 2, 211, 90, 23, 72]
          is_paused: false
        zkusd_token_id: [162, 165, 91, 243, 19, 16, 1, 103, 78, 45, 252, 149, 41, 68, 216, 112, 170, 183, 181, 237, 223, 146, 156, 27, 222, 31, 30, 115, 156, 35, 7, 112]
        stability_pool_id: [185, 65, 44, 165, 216, 237, 108, 163, 77, 91, 49, 108, 165, 28, 150, 12, 139, 198, 154, 169, 109, 228, 103, 201, 228, 235, 123, 191, 171, 36, 227, 32]
        price_oracle_id: [238, 119, 148, 5, 248, 143, 137, 12, 104, 88, 30, 113, 107, 13, 202, 208, 87, 98, 68, 9, 65, 166, 170, 2, 72, 199, 34, 161, 237, 224, 89, 67]
        active_pool: [15, 239, 114, 232, 40, 108, 13, 216, 213, 221, 86, 158, 147, 4, 51, 195, 34, 51, 13, 51, 134, 80, 173, 193, 170, 10, 69, 2, 211, 90, 23, 72]
        default_pool: [15, 239, 114, 232, 40, 108, 13, 216, 213, 221, 86, 158, 147, 4, 51, 195, 34, 51, 13, 51, 134, 80, 173, 193, 170, 10, 69, 2, 211, 90, 23, 72]

  # Input 1: BTC collateral UTXO (raw BTC, no existing charms)
  - utxo_id: "fa59c666eb4bdc531ca9a4f31fd52b8e4d1a8e23248dc2e19fa2be27ac404a00:3"
    charms: {}

  # Input 2: Token V8 state UTXO (consumed - total_supply updates)
  - utxo_id: "5f0e8aa6b39ae268c743bf6216e299533612344dc1daecdcf98dc7eae726d48d:0"
    charms:
      $02:
        admin: [15, 239, 114, 232, 40, 108, 13, 216, 213, 221, 86, 158, 147, 4, 51, 195, 34, 51, 13, 51, 134, 80, 173, 193, 170, 10, 69, 2, 211, 90, 23, 72]
        authorized_minter: [230, 86, 76, 0, 213, 234, 140, 184, 34, 108, 124, 51, 74, 183, 8, 156, 128, 97, 73, 222, 190, 19, 130, 199, 92, 25, 9, 244, 71, 41, 11, 60]
        total_supply: 0

outs:
  # Output 0: Updated VaultManager state (incremented counters)
  - address: tb1qr25l2p34sv4wnz4q0cuh4g9jd9qh2eua6y5awq
    charms:
      $00:
        protocol:
          total_collateral: 500000
          total_debt: 1200000000
          active_vault_count: 1
          base_rate: 50
          last_fee_update_block: 120228
          admin: [15, 239, 114, 232, 40, 108, 13, 216, 213, 221, 86, 158, 147, 4, 51, 195, 34, 51, 13, 51, 134, 80, 173, 193, 170, 10, 69, 2, 211, 90, 23, 72]
          is_paused: false
        zkusd_token_id: [162, 165, 91, 243, 19, 16, 1, 103, 78, 45, 252, 149, 41, 68, 216, 112, 170, 183, 181, 237, 223, 146, 156, 27, 222, 31, 30, 115, 156, 35, 7, 112]
        stability_pool_id: [185, 65, 44, 165, 216, 237, 108, 163, 77, 91, 49, 108, 165, 28, 150, 12, 139, 198, 154, 169, 109, 228, 103, 201, 228, 235, 123, 191, 171, 36, 227, 32]
        price_oracle_id: [238, 119, 148, 5, 248, 143, 137, 12, 104, 88, 30, 113, 107, 13, 202, 208, 87, 98, 68, 9, 65, 166, 170, 2, 72, 199, 34, 161, 237, 224, 89, 67]
        active_pool: [15, 239, 114, 232, 40, 108, 13, 216, 213, 221, 86, 158, 147, 4, 51, 195, 34, 51, 13, 51, 134, 80, 173, 193, 170, 10, 69, 2, 211, 90, 23, 72]
        default_pool: [15, 239, 114, 232, 40, 108, 13, 216, 213, 221, 86, 158, 147, 4, 51, 195, 34, 51, 13, 51, 134, 80, 173, 193, 170, 10, 69, 2, 211, 90, 23, 72]

  # Output 1: New Vault NFT
  - address: tb1qr25l2p34sv4wnz4q0cuh4g9jd9qh2eua6y5awq
    charms:
      $00:
        id: [87, 46, 248, 147, 118, 173, 125, 47, 94, 0, 109, 225, 244, 162, 51, 17, 74, 101, 132, 139, 174, 166, 33, 106, 105, 156, 221, 199, 73, 35, 184, 45]
        owner: [15, 239, 114, 232, 40, 108, 13, 216, 213, 221, 86, 158, 147, 4, 51, 195, 34, 51, 13, 51, 134, 80, 173, 193, 170, 10, 69, 2, 211, 90, 23, 72]
        collateral: 500000
        debt: 1200000000
        created_at: 120228
        last_updated: 120228
        status: Active
        interest_rate_bps: 100
        accrued_interest: 0
        redistributed_debt: 0
        redistributed_collateral: 0
        insurance_balance: 0

  # Output 2: Updated Token state NFT (supply increased)
  - address: tb1qr25l2p34sv4wnz4q0cuh4g9jd9qh2eua6y5awq
    charms:
      $02:
        admin: [15, 239, 114, 232, 40, 108, 13, 216, 213, 221, 86, 158, 147, 4, 51, 195, 34, 51, 13, 51, 134, 80, 173, 193, 170, 10, 69, 2, 211, 90, 23, 72]
        authorized_minter: [230, 86, 76, 0, 213, 234, 140, 184, 34, 108, 124, 51, 74, 183, 8, 156, 128, 97, 73, 222, 190, 19, 130, 199, 92, 25, 9, 244, 71, 41, 11, 60]
        total_supply: 1000000000

  # Output 3: Minted zkUSD tokens (fungible - 10 zkUSD to admin)
  - address: tb1qr25l2p34sv4wnz4q0cuh4g9jd9qh2eua6y5awq
    charms:
      $01: 1000000000

  # Output 4: Change (remaining BTC)
  - address: tb1qr25l2p34sv4wnz4q0cuh4g9jd9qh2eua6y5awq
    charms: {}
